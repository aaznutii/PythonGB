SHOW tables
-- Представления

-- Просмотр состава групп
CREATE OR REPLACE VIEW SHOW_GROUPS (STUD, GROUP_NUM, PROGR_ID)
AS SELECT CONCAT_WS(' ', FIRST_NAME, LAST_NAME, PATRONYMIC), 
EG.NAME, EG.ID AS PROGR_ID
FROM 
STUDENTS S
LEFT JOIN EDUCATIONAL_GROUPS EG ON S.EDUCATIONAL_GROUP_ID = EG.ID
ORDER BY EG.NAME DESC;

-- Просмотр сведений об оплате
CREATE OR REPLACE VIEW SHOW_MONEY 
AS SELECT 
CONTRACTS.FULL_NUMBER AS FULL_NUMBER, CONTRACTS.DOC_DATE AS DOC_DATE,  
P.PAYMENT AS PAYMENT, P.CREATED_AT AS PAY_DATE,
D.SHORT_NAME AS DEARTMENT,
PR.NAME AS PROGRAMS, PR.TYPE_PROGRAM AS TYP,
GET_CONTRAGENT(C.CONTRAGENT_ID, C.CONTRAGENT_TYPE) AS CONTRAGENT
FROM 
CONTRACTS
LEFT JOIN PAYMENTS P ON CONTRACTS.ID = P.CONTRACT_ID 
LEFT JOIN DEPARTMENTS D ON D.ID = CONTRACTS.DEPARTMENT_ID
LEFT JOIN PROGRAMS PR ON PR.ID = P.PROGRAM_ID
LEFT JOIN CONTRAGENTS C ON C.ID = CONTRACTS.CONTRAGENT_ID;



-- Запросы

-- Перечень групп с количеством обучающихся
SELECT 
  EG.NAME AS GROUP_NUM,
  COUNT(S.ID) AS COUNT_STUD 
FROM 
STUDENTS S
LEFT JOIN EDUCATIONAL_GROUPS EG ON S.EDUCATIONAL_GROUP_ID = EG.ID
GROUP BY EG.NAME
ORDER BY COUNT_STUD DESC;

-- Выбор конкретной группы

SELECT STUD, GROUP_NUM, PROGR_ID,
P.NAME AS 'ПРОГРАММА', P.LABOR_INTENSITY AS 'ЧАСОВ', P.TYPE_PROGRAM AS 'ТИП'
FROM SHOW_GROUPS 
LEFT JOIN PROGRAMS P ON P.ID = PROGR_ID 
WHERE GROUP_NUM = '98462' ORDER BY STUD ASC;

SELECT * FROM SHOW_MONEY;
SELECT * FROM SHOW_GROUPS;
      